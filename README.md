## アウトプット用ブログの作成（プライベート）

### 案件概要

資格取得が一服し、そろそろ身につけたり、日頃の情報収集で見聞きした技術について棚卸しとアウトプットが必要と感じました。また、自分の好きなフロントエンドの技術を使いたかったので、まずは題材として新規にブログを作成することにしました(元々、エンジニアとしての入りがブログの作成(インフラ構築含む)だったこともあり、自分はフロントエンドとインフラの技術を好んでいます)。

### 使用技術

- フロントエンド:
  - TypeScript/ Next.js/ Apollo Client/ Amazon S3(静的ホスティング)/ Amazon Cloud Front/ Cloudinary
- API サーバー
  - TypeScript/ Apollo Server/ Cloud Run/ Docker
- 記事入稿システム
  - TypeScript/ Python/ AWS Lambda/ AWS SQS/ DynamoDB/ Amazon S3
- IaC
  - AWS CDK/ TypeScript
- CI/CD
  - GitHub Actions

以下のリポジトリに環境構成図を作成しました。今の自分の興味分野・得意分野を俯瞰したものになっているかなと思います。実力判断などのご参考になれば幸いです。
https://github.com/fijixxx/sublog-architecture

### 工夫した点

今回、ブログを作成するにあたって、自分で以下の要件を設定しました。

- システムの拡張や修正がしやすいように、マイクロサービスを意識して構築すること
- 機能の開発や記事の入稿がしやすいように、 CI/CD の仕組みをしっかりやること
- 新しい技術をできるだけ盛り込むこと

それぞれ解説していくと、

### システムの拡張や修正がしやすいように、マイクロサービスを意識して構築すること

これはマイクロサービスの構成が流行しているからというのもあるのですが、できるだけ小さくつくってこまめにリリースすることを心がけることで、仕事やプライベートが忙しいときでも開発を続行したり、開発が中断しても続きから再開しやすくすることを考えています（ビッグなリリースになると、開発中に中断してしまったときの再開やリリース後のバグ対応への勘所が失われていてつらい）。

#### 要件に対応する技術

型情報を利用できる言語を選ぶと、特にコードを書いた後のリファクタリングがやりやすい（VSCode の Linter などの支援を最大限に受けられる）ので、開発言語については TypeScript 、バックエンドとのインターフェースには Apollo（GraphQL）を使用しています。

### 機能の開発や記事の入稿がしやすいように、 CI/CD の仕組みをしっかりやること

継続的に開発を行うにあたって、定型的で何度も繰り返すような作業は自動化して本質的な機能追加やコンテンツ拡充に集中したいという思いがありました。また、マイクロサービス的なプロダクトを運用するにあたって、散らばりがちなリソースをコードで一元管理することで、無駄な課金やセキリュティ設定のチェックも容易になったと思います。

#### 要件に対応する技術

GitHub Actions, AWS CDK を使って CI/CD を実現しています。また、 CI/CD からは離れているかもしれませんが、 GitHub の issue や project を使って、タスク管理を行なっています。

### 新しい技術をできるだけ盛り込むこと

技術について、(知っているだけでなく)触ってみて初めてわかる感覚的な知見があるな、と経験から思っているので、自分にとって挑戦的な採用となる技術でも、積極的に使っています。

## サーバレス業務システム開発

### 案件概要

社会保険系法人様の業務システムの大幅刷新案件(運用プラットフォームの AWS 移行、サービスのサーバレス化、運用自動化)

### 担当

テストチームに早期から参画し、案件序盤ではテスト自動化や CI/CD 手法の考案と検証を担当しました。

案件中盤からは、上記の考案に基づいたサンプルプロジェクトやテスト実施ガイドの作成や、上記以外にテストチームの作業で必要な AWS リソースの検討や、それらの利用フローや使用方法をドキュメント化する作業を担当していました。

テストフェーズ開始後は、 Selenium(Python) テストコードの作成とレビュー、テスト実施を担当しました。

### CI

PM の方や開発チームの方と検討したところ、CI 内容として「Python コードの単体テスト」「Selenium の結合(E2E)テスト」を盛り込むことになりました。テストチームとして要求するカバレッジ率やログ内容を検討した後、その指標が出力される設定ファイルや期待するテストコードのサンプルなどを含んだサンプルプロジェクトの作成や、テストコード関連のトラブルシューティングを担当しました。単体テスト(Unittest)、結合テスト(Selenium)ともに Python で作成しましたが、案件参画時点ではあまり習熟していなかったこともあり、サンプル作成やトラブルシューティングは大変でしたが、短期間で多くの Python 関連の知識を得ることができましたし、作成したサンプルやガイドを開発チームやテストチームで役立てていただけて達成感を感じました。

### テストチームにおける、AWS リソース利用の窓口・ドキュメント作成

テストチームとして最終的には 10 名以上のメンバーが集まりましたが、AWS について少しでも知見のあるメンバーは自分 1 人という状況だったので、テストに必要な AWS リソースの利用について他社の方と検討したり、それらの使い方やデータ投入方法（例えば、 Cognito の ユーザーやプロパティの追加方法だったり、AWS CLI をインストールして開発用ロールを使うための設定だったり）を調査してテストチームメンバー向けに説明したり、ドキュメント化して回ったので、 AWS リソースについて広く知見を貯められたかなと思います。

### 反省点

デプロイについては、方針が固まる前に管轄が自分の手から離れてしまったことで、実際にされた運用的には、ローカル端末でのオペレーションやデプロイ作業がされるようになってしまっていました。これらは Git の操作ミスなどに起因するデプロイミスを誘発し、また、一部の特殊なデプロイに関しては、故障対応後の再デプロイの際に時間がかかったりデプロイミスが起こっていました。また、デプロイ知識や手法が属人化してしまうことで、担当者の離任後に引き継ぎ者によるデプロイがうまくいかず、トラブルシューティングに時間がかかってしまうなど、アンチパターンを実践する結果となっていました。

### 反省点に対しての if 案

こちらについては、何らかの手段で「デプロイのコード化(IaC)と共有」ができていれば、再現性のあるデプロイを実行できて上記のような失敗を防げたと考えています。今回の場合、ローカルや開発環境からステージ環境のリソースを自由に扱える IAM ユーザーとロールが払い出されていたので、例えば、開発環境上に CodePipeline を構築し、テスト環境の IAM ユーザーとロールのクレデンシャルで CodeBuild を動かしてデプロイしたり、開発環境にライブラリ管理用の共有 EC2 を立てて、そこにデプロイ用リソースを集約するなど、何かしら手は打てたのかなと、振り返っています。

## オンプレ Web アプリの AWS 移行および toC メディアの AWS 移行におけるテスト故障対応

### 案件概要

不動産情報系サイト運営企業様の、toC メディアサービス基盤の AWS 移行案件

### 担当

クライアント企業様内のユーザー部門向けツール(Web アプリ)の AWS 移行を担当しました。特にミッションクリティカルな要求はなく、現行アプリ自体も、1 つのサーバーに Web サーバー(IIS)/アプリ本体(PHP)/ユーザー管理 DB(MySQL) が同居しているような、ちょっとしたツールだったので、作業要員としては自分 1 人で進めていました。

#### 自動バックアップ

機能追加として、自動バックアップ機能を実装しました。まずバックアップ対象について検討した結果、定時バックアップが必要なリソースは、本アプリ内に同居した MySQL DB と 操作/アクセスログ だけでした。MySQL のデータについて、相談したところ「更新がまれで、かつ、行列数も非常に少なく、万が一消失したとしても手入力で十分対応可能」とのことだったので、バックアップ方法は「毎日定時に MySQL のダンプを作成し、ログと一緒に AWS CLI を使って S3 にアップロードする」シェルスクリプトを cron で動かす、という仕組みにしました。本当にバックアップの必要なリソースを検討し、 EBS や AMI ごとバックアップを取る方法を回避したことで、世代管理の設定をしなくていいなど運用をシンプルにすることができたかなと思います。

#### テスト

テストでは Puppeteer という ヘッドレス Chrome を扱える Node.js のライブラリを使用したのですが、これはちょうど前の案件で自動テストツールの存在を知ったところで、要件がマッチする本案件に参画できたので、この機会に使ってみて知見を貯めよう、ということで、自分から導入の提案をしたものでした。ここでの自動テスト経験が次の案件への引き合いになったのかなと思っていて、チャレンジしてよかったです。
